# HEIF 解码器错误日志分析与处理指南

## 问题描述

在播放 HEIF/HEIC 格式图片时，Android 系统的 HEIF 解码器会报错：

```
HeifDecoderImpl: getSize: not supported!
```

## 调查与分析

经过详细调查和测试，我们发现：

1.  **错误日志的性质**：这个错误日志**可能是一个无害的内部日志输出**，并不表示图片加载或显示失败。
2.  **实际功能影响**：在出现此错误日志的情况下，图片仍能正常加载、显示和流畅切换。
3.  **用户反馈确认**：用户确认在出现此错误日志时，播放体验是流畅的。

## 结论

对于 `HeifDecoderImpl: getSize: not supported!` 错误：
- **无需特殊处理**：如果图片能正常加载和显示，此错误日志可以忽略。
- **关注实际效果**：应以实际的图片加载、显示和播放流畅度为准，而非仅依赖日志。

## 处理过程记录

### 尝试方案 1：全局禁用硬件位图
- **效果**：能消除错误日志，但显著降低性能和增加内存占用。
- **用户反馈**：不可接受，影响流畅度。

### 尝试方案 2：智能降级策略
- **效果**：保持了大部分图片的高性能，针对性处理 HEIF 格式。
- **用户反馈**：由于大多数图片都是 HEIF 格式，此方案仍会影响主要使用场景的性能。

### 最终方案：保持原状
- **效果**：保留原有高性能配置，忽略无害的错误日志。
- **用户反馈**：符合预期，之前的流畅体验得到保持。

## 最佳实践

1.  **区分日志与功能**：不是所有错误日志都代表功能异常，需结合实际效果判断。
2.  **以用户体验为准**：如果功能正常且体验良好，无需为消除日志而牺牲性能。
3.  **针对性优化**：只有在确认日志影响实际功能时，才进行针对性优化。

## 相关资源

- [Glide Hardware Bitmaps](https://bumptech.github.io/glide/doc/hardwarebitmaps.html)
- [Android Hardware Bitmap](https://developer.android.com/reference/android/graphics/Bitmap.Config#HARDWARE)
- [HEIF Format](https://en.wikipedia.org/wiki/High_Efficiency_Image_File_Format)

## 修改历史

- 2026-02-05: 初始版本，记录问题和调查过程
- 2026-02-05: 更新结论，确认错误日志无害，保持原配置